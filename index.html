<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Interactive PCB Viewer ‚Äî v3 (connector hotspots)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="preload" as="image" href="assets/board-top.jpg">
<style>
  :root { --bg:#0b0d10; --ink:#e8eef5; --muted:#9aa4b2; --accent:#e63946; --glass:rgba(20,24,28,.9); }
  * { box-sizing:border-box }
  html,body { margin:0; height:100%; background:var(--bg); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial }
  #app { display:grid; grid-template-columns: 1fr 360px; height:100vh; }
  #stage { position:relative; overflow:hidden; border-right:1px solid #1c2127; }
  #viewport { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(1); transform-origin:center center; touch-action:none; }
  #board { display:block; max-width:none; user-select:none; pointer-events:none; }
  #overlay { position:absolute; inset:0; pointer-events:none; } /* svg root */
  .pin, .hotspot { pointer-events:auto; cursor:pointer; }
  .pin circle { fill:var(--accent); opacity:.92; }
  .pin text { fill:white; font:600 10px/1 sans-serif; text-anchor:middle; dominant-baseline:central; }

  /* Hotspot look (clickable connector areas) */
  .hotspot { fill: #e6394620; stroke: var(--accent); stroke-width: 2; }
  .hotspot:hover, .hotspot:focus { fill: #e6394635; outline: none; }

  .label { fill:white; font:700 11px/1 sans-serif; text-anchor:middle; dominant-baseline:central; paint-order:stroke; stroke:#000; stroke-width:2; }

  #hud { position:absolute; top:12px; left:12px; display:flex; gap:8px; flex-wrap:wrap }
  .chip { background:var(--glass); border:1px solid #1c2127; padding:6px 10px; border-radius:10px; display:flex; align-items:center; gap:8px }
  .btn { cursor:pointer; user-select:none }
  input#search { background:transparent; border:none; color:var(--ink); outline:none; min-width:220px }

  #panel { background:linear-gradient(180deg, rgba(18,21,26,.98), rgba(10,12,14,.98)); border-left:1px solid #1c2127; height:100%; display:flex; flex-direction:column }
  #panel header { padding:14px 16px; border-bottom:1px solid #1c2127; display:flex; gap:8px; align-items:center }
  #list { padding:8px 10px; overflow:auto; flex:1 }
  #detail { padding:14px 16px; overflow:auto; flex:1; display:none }
  .item { padding:10px; border:1px solid #1c2127; border-radius:12px; background:rgba(255,255,255,.02); margin:8px 0; cursor:pointer }
  .item small { color:var(--muted) }
  .hero { width:100%; border-radius:12px; border:1px solid #1c2127; margin:8px 0 }
  .tag { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #2b3138; color:#b7c3d0; margin-right:6px; }
  .back { margin-left:auto; display:none; cursor:pointer; opacity:.85 }

  /* Draw mode visuals */
  .draw-point { fill:#fff; stroke:#000; stroke-width:1 }
  .draw-path { fill:#3fb95022; stroke:#3fb950; stroke-width:2; stroke-dasharray:4 4 }
  .mode-on { outline:2px solid #3fb950 }
  .hint { color:#b7c3d0; font-size:12px; margin-left:6px }

  @media (max-width:980px){
    #app { grid-template-columns: 1fr; grid-template-rows: minmax(40vh, 55vh) 1fr; }
    #panel { grid-row:2; }
  }
</style>
</head>
<body>
<div id="app">
  <div id="stage" aria-label="Interactive PCB canvas">
    <div id="viewport">
      <img id="board" src="assets/board-top.jpg" alt="PCB top view" draggable="false">
      <svg id="overlay"></svg>
    </div>

    <div id="hud">
      <div class="chip">üîé <input id="search" placeholder="Search J21, USB, safety‚Ä¶" aria-label="Search components"></div>
      <div class="chip btn" id="fit">‚ÜôÔ∏è Fit</div>
      <div class="chip btn" id="reset">üóò Reset</div>
      <div class="chip btn" id="draw">‚úèÔ∏è Draw hotspot <span class="hint" id="hint">(off)</span></div>
      <div class="chip btn" id="coords">üìç Get coords <span class="hint" id="coordsState">(off)</span></div>
    </div>
  </div>

  <aside id="panel">
    <header>
      <strong>Components</strong>
      <span class="back" id="backBtn">‚óÄ Back</span>
    </header>
    <div id="list" role="list"></div>
    <div id="detail"></div>
  </aside>
</div>

<script>
/* ========= 1) Data (EDIT THIS) =========
You can use either:
- point pin:   { ref, name, coords:{x,y}, ... }
- polygon area:{ ref, name, shape:{ type:'polygon', points:[[x,y],...]} , coords:{x,y} (label center, optional) }

Use the Draw Hotspot tool to create 'shape' snippets.
*/
const PARTS = [
  {
    ref: "J21",
    name: "Floor Safety Connector",
    // Example polygon (fake points‚Äîreplace with real ones you draw)
    shape: { type: "polygon", points: [[860,360],[940,360],[952,395],[845,396]] },
    coords: { x: 900, y: 380 },
    purpose: "Interface for floor safety sensor loop; required for unmanned run mode.",
    tags: ["Safety","I/O","24]()
